// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// 1. Define Roles
enum Role {
  ADMIN
  EMPLOYEE
}

// 2. Unified User Model
model User {
  id       String @id @default(auto()) @map("_id") @db.ObjectId
  username String @unique
  password String 
  role     Role   @default(EMPLOYEE)
  createdAt DateTime @default(now())
}

// 3. Short Links (Public Utility)
model ShortLink {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  originalUrl String
  shortCode   String   @unique
  createdAt   DateTime @default(now())
  creatorIP   String?  
  clicks      Int      @default(0)
  logs        ClickLog[]
}

// 4. Blog Posts
model BlogPost {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  title           String
  slug            String   @unique
  content         String   
  excerpt         String
  image           String?
  categories      String[]
  
  // SEO
  metaTitle       String
  metaDescription String
  metaKeywords    String
  focusKeyword    String
  
  publishedAt     DateTime @default(now())
  updatedAt       DateTime @updatedAt
  isPublished     Boolean  @default(false)
}

// 5. Global Settings
model AdminSettings {
  id            String @id @default(auto()) @map("_id") @db.ObjectId
  adRedirectUrl String @default("https://google.com") 
  totalAdClicks Int    @default(0)
}

// 6. Analytics
model AdBounceLog {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt DateTime @default(now())
  ipAddress String?
  userAgent String?
  targetUrl String?
  device    String?  
  os        String? 
  browser   String?
}

model ClickLog {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  shortLinkId String   @db.ObjectId
  shortLink   ShortLink @relation(fields: [shortLinkId], references: [id])
  
  timestamp   DateTime @default(now())
  ipAddress   String?
  userAgent   String?  
  referrer    String?  
  country     String?  
  city        String?  
  device      String? 
  os          String?    
  browser     String?     
}